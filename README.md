# YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos

# Εισαγωγή
Η εργασία αυτή υλοποιεί μια εφαρμογή Flask που χρησιμοποιεί τη βιβλιοθήκη PyMongo για να συνδεθεί σε ένα τοπικό MongoDB και να εκτελέσεις λειτουργίες βάσης δεδομένων. Επιτρέπει σε χρήστες να δημιουργούν λογαριασμούς να κάνουν κρατήσεις 
πτήσεων, να αναζητούν πτήσεις σε ένα σύστημα αεροπορικών εισητηρίων να κάνουν κρατήσεις αεροπορικών εισητηρίων και αρκετά άλλα που θα παρουσιαστούν αναλυτικά στη συνέχεια.

# Ανάλυση σύνδεσης
Αρχικά συνδέουμε την εφαρμογή με την MongoDB βάση δεδομένων μέσω του MongoClient. Η διεύθυνση του MongoDB server παίρνεται από τη μεταβλητή περιβάλλοντος mongoHostName.
```
hostname = os.environ.get('mongoHostName')
client = MongoClient(hostname, 27017)
```
Αυτό γίνεται για να τρέχει το πρόγραμμα μέσω του docker και όχι από ένα απλό localhost.
******************************************************************************************************************************************************************************************************************************
Στη συνέχεια ορίζονται οι συλλογές της βάσης δεδομένων που θα χρησιμοποιηθούν για την αποθήκευση πληροφοριών χρηστών, πτήσεων και κρατήσεων.
```
db = client['DigitalAirlines']
users = db['users']
flights = db['flights']
reservations = db['reservations']
```
******************************************************************************************************************************************************************************************************************************
Και τέλος δημιουργούμαι μια νέα Flask εφαρμογή 
```
app = Flask(__name__)
```
******************************************************************************************************************************************************************************************************************************
Οι global μεταβλητές 
```
isloggedin = False
isuser = False
username1 = "None"
```
χρησιμοποιούνται αργότερα στο πρόγραμμα για να ελέγχουμε αν ο χρήστης είναι συνδεδεμένος στην εφαρμογή, τι ρόλο έχει και ποιό είναι το username του αντίστοιχα. 

# Λειτουργίες Συστήματος

__@app.route("/register", methods=["POST"])__

Σε αυτό το endpoint αναπτύσσεται μια ενέργεια εγγραφής στην εφαρμογή. 

Οι πληροφορίες που ο χρήστης παρέχει συλλέγονται από το αίτημα (request) και αποθηκεύονται στις μεταβλητές username και email.Γίνεται έλεγχος για να διαπιστωθεί εάν υπάρχει ήδη χρήστης με ίδιο username ή το ίδιο email στη βάση δεδομένων. 

Αυτό γίνεται αναζητώντας έναν υπάρχοντα χρήστη με τη χρήση της μέθοδου find_one() στη συλλογή (collection) "users" και χρησιμοποιώντας τον τελεστή $or για να ελέγξει εάν υπάρχει είτε ίδιο email είτε ίδιο όνομα χρήστη.

Εάν υπάρχει ήδη ένας χρήστης με τις ίδιες πληροφορίες, επιστρέφεται ένα μήνυμα λάθους στη μορφή ενός αντικειμένου Response με κωδικό κατάστασης 409 (Conflict). 

Εάν δεν υπάρχει ο χρήστης, δημιουργείται ένα αντικείμενο με τις πληροφορίες που έδωσε ο χρήστης. Οι πληροφορίες αποθηκεύονται σε ένα λεξικό με τα πεδία "username", "email", "first_name", "last_name", "password", 
"birthdate", "country", "passport_number" και "role". Στο πεδίο "role" αποθηκεύεται αυτόματα η ιδιότητα του "user" καθώς με βάση την εκφώνηση μόνο users μπορούν να κάνουν register.

Το αντικείμενο του χρήστη προστίθεται στη συλλογή "users" με τη χρήση της μεθόδου insert_one().

Τέλος επιστρέφεται ένα αντικείμενο Response με κωδικό κατάστασης 201 (Created) για να υποδείξει ότι η εγγραφή ολοκληρώθηκε με επιτυχία.
![image](https://github.com/VaggelisGavrielatos/YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos/assets/132483480/908d3501-657f-4409-9fb5-e31517c8a21a)

******************************************************************************************************************************************************************************************************************************
__@app.route("/login", methods=["POST"])__

Οι public μεταβλητές isloggedin, isuser και username1 χρησιμοποιούνται για να παρακολουθήσουν αν ο χρήστης είναι συνδεδεμένος, τον ρόλο του χρήστη και το όνομα χρήστη του συνδεδεμένου χρήστη.

Γίνεται έλεγχος για να ελεγχθεί αν ο χρήστης είναι ήδη συνδεδεμένος (isloggedin). Αν είναι ήδη συνδεδεμένος, επιστρέφεται ένα μήνυμα απόρριψης με κωδικό 403 (Forbidden) που δηλώνει ότι ο πόρος είναι απαγορευμένος. Αν ο χρήστης δεν είναι συνδεδεμένος, λαμβάνονται οι πιστοποιητικές πληροφορίες του χρήστη (email και κωδικός πρόσβασης) από την αίτηση POST.

Αναζητάμε στο collection των users αν για τα στοιχεία που εισήγαγε ο χρήστης υπάρχει κάποια αντίστοιχη εγγραφή στο σύστημα. Αν δεν υπάρχει κάποια εγγραφή που να αντιστοιχεί στα credentials εισαγωγής του χρήστη τότε επιστρέφεται μήνυμα λάθους με κωδικό 401 (Unauthorized). 
![image](https://github.com/VaggelisGavrielatos/YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos/assets/132483480/c80604fe-1c32-476a-9bc7-4c2b1d55885f)

Αλλιώς αν υπάρχει ο χρήστης τότε θέτουμε την μεταβλητή isloggedin σε True και στη μεταβλητή username1 αποθηκεύουμε το username του χρήστη που μόλις συνδέθηκε. Επίσης ανάλογα με τον ρόλο που έχει ο συνδεδεμένος χρήστης επιστρέφεται και το αντίστοιχο μήνυμα σύνδεσης με κωδικό 200 (OK). 
![image](https://github.com/VaggelisGavrielatos/YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos/assets/132483480/4f89dd30-eab3-4ee4-a620-0fe720e88492)
******************************************************************************************************************************************************************************************************************************
__@app.route("/login", methods=["POST"])__

Αρχικά γίνεται έλεγχος για το εάν είναι συνδεδεμένος κάποιος χρήστης στην εφαρμογή. Αν δεν υπάρχει κάποιος συνδεδεμένος χρήστης τότε θα επιστραφεί μήνυμα λάθους με κωδικό 401 (Unauthorized).
![image](https://github.com/VaggelisGavrielatos/YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos/assets/132483480/507a2f27-021d-497d-b4e8-5a82123844ba)

Σε αντίθετη περίπτωση που ο χρήστης είναι συνδεδεμένος, τότε θέτεται η μεταβλητή isloggedin σε False και επιστρέφεται μήνυμα αποσύνδεσης με κωδικό 200 (OK).
![image](https://github.com/VaggelisGavrielatos/YpoxreotikiErgasia23_e20019_Gavrielatos_Evangelos/assets/132483480/c8ae707f-f4a5-408d-9c65-d7afe034b235)
******************************************************************************************************************************************************************************************************************************


































